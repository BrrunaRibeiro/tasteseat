{% extends "landing/base.html" %}
{% block content %}
{% load static %}
<div class="container mt-5">
    <div class="row">
        <div class="col-md-5">
            <img src="{{ restaurant.image.url }}" class="img-fluid" alt="{{ restaurant.name }}">
        </div>
        <div class="col-md-6">
            <h1>{{ restaurant.name }}</h1>
            <p>{{ restaurant.get_cuisine_type_display }}</p><br>

            <p class="resto-info">
                <strong>Address:</strong> {{ restaurant.address }}<br>
                <strong>Phone Number:</strong> {{ restaurant.phone_number }}<br>
            </p>
            <hr>
            <h2>Book a Table</h2>
            <div class="form-group">
                <label for="guest-select">Number of Guests</label>
                <select id="guest-select" class="form-control" onchange="updateAvailability();">
                    <option value="1">1</option>
                    <option value="2" selected>2</option>
                    <option value="3">3</option>
                    <option value="4">4</option>
                    <option value="5">5+</option>
                </select>
            </div>
            <br>
            <div class="form-group">
                <label>Available Times for {{ selected_date }}</label>
                <div id="time-slots">
                    {% for time, available in available_times.items %}
                    <span class="time-slot {% if available %}available{% else %}unavailable{% endif %}"
                        data-time="{{ time }}" onclick="selectTime(this, {{ available|lower }});">
                        {{ time }}
                    </span>
                    {% endfor %}
                </div>
                <br>
                <br>
                <div class="form-group">
                    <label>Book for another Day</label>
                    <input type="date" id="date-picker" class="form-control" value="{{ selected_date }}"
                        onchange="updateAvailability();">
                </div>
            </div>

            <form id="booking-form" method="POST" style="display: none;">
                {% csrf_token %}
                {{ form.as_p }}
                <input type="hidden" name="booking_time" id="booking_time">
                <button type="submit" class="btn btn-primary">Book Now</button>
            </form>
        </div>
        <script>
            function updateAvailability() {
                let guestCount = document.getElementById('guest-select').value;
                let selectedDate = document.getElementById('date-picker').value;
                window.location.href = window.location.pathname + `?guests=${guestCount}&date=${selectedDate}`;
            }
    
            function selectTime(element, available) {
                if (available) {
                    document.getElementById('booking_time').value = element.getAttribute('data-time');
                    document.getElementById('booking-form').style.display = 'block';
                } else {
                    alert('This time is not available. Please select another.');
                }
            }
        </script>
    </div>
</div>

{% endblock %}